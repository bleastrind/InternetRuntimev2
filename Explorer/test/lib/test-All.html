
<script type="text/javascript"> 
var Lib_Style = 
{
	first: function(obj)
	{
		obj.style.backgroundColor = '#DCE9F9';
		obj.style.backgroundImage = '-moz-linear-gradient(center top , #EBF3FC, #DCE9F9)';
		obj.style.boxShadow = '0 1px 0 rgba(255, 255, 255, 0.8) inset';
		obj.style.border = '1px solid #CCCCCC';
		obj.style.borderRadius = '6px 6px 6px 6px';
	}
};



var Lib_Tween =
{
	'None': function(pct)
	{
		return pct;
	},
	'Quad': function(pct)
	{
		return -(Math.pow((pct-1), 2) -1);
	}
};



var Lib_Route =
{
	Line: function(obj, originxy, targetxy, d, wrapper)
	{
		var Distance = targetxy.getDistance(originxy);
	///	alert(originxy.x);
		var WrappedXY = null;
		if (wrapper)
			WrappedXY = wrapper.getWrappedOrigin();
		obj.style.left = WrappedXY.x + Distance.scale(d).dx + 'px';
		obj.style.top = WrappedXY.y + Distance.scale(d).dy + 'px';
	}
}


function Wrapper(dr, ds, sz, sn)
{
	var w = document.createElement('div');
	var Direction = 'center';
	var DirectionMatrix = 
	{
		center: {left: 0, top: 0},
		right: {left: 1, top: 0},
		left: {left: -1, top: 0},
		up: {left: 0, top: 1},
		down: {left: 0, top: -1},
	}
	var Distance = 0;
	var Size = 'origin';
	var Seen = false;
	
	var WrappedXY = null;
	if (dr != null)
		Direction = dr;
	if (ds != null)
		Distance = ds;
	if (sz != null)
		Size = sz;
	if (sn != null)
		Seen = sn;
		
	this.getWrappedOrigin = function()
	{
		return WrappedXY;
	}
	
	this.wrap = function(Object)
	{
		if (Size == 'origin')
		{	
			//need to concern css effects
			w.style.width = parseInt(Object.style.width) + 2 + 'px';
			w.style.height = parseInt(Object.style.height) + 2 + 'px';
		}
		w.style.position = 'absolute';
		w.style.left = (parseInt(Object.style.left) 
						+ DirectionMatrix[Direction].left 
						* (parseInt(Object.style.width) + Distance)) + 'px';
		w.style.top = (parseInt(Object.style.top) 
						+ DirectionMatrix[Direction].top 
						* (parseInt(Object.style.height) + Distance)) + 'px';
		Object.parentNode.appendChild(w);		
		w.appendChild(Object);
		Object.style.position = 'absolute';
		WrappedXY = new AbsoluteXY(-1 * DirectionMatrix[Direction].left 
									* (parseInt(Object.style.width)),
									-1 * DirectionMatrix[Direction].top 
									* (parseInt(Object.style.height)));
		Object.style.left = WrappedXY.x + 'px';
		//alert(Object.style.left);
		Object.style.top = WrappedXY.y + 'px';
		if (!Seen)
			w.style.overflow = 'hidden';
	}
	this.unwrap = function(Object)
	{
	
	}
}


function DistanceXY(dx, dy)
{
	this.dx = dx;
	this.dy = dy;
	this.scale = function(s)
	{
		return new DistanceXY(this.dx * s, this.dy * s);
	}
}

function AbsoluteXY(x, y)
{
	this.x = x;
	this.y = y;
	this.Plus = function(d)
	{
		this.x = x + d.dx;
		this.y = y + d.dy;
		return this;
	}
	this.getDistance = function(abxy)
	{
		return new DistanceXY(this.x - abxy.x, 
								this.y - abxy.y)
	}
}



function Show(Object)
{	
	var Tween = Lib_Tween['None'];
	var Time = 500;
	var EndOpacity = 1;
	var CallBack = function(){};	
	//Getters
		
	//Setters
	this.Tween = function(tn)
	{
		Tween = Lib_Tween[tn];
		return this;
	};	
	this.Time = function(tm)
	{
		Time = tm;
		return this;
	};
	this.EndOpacity = function(eo)
	{	
		EndOpacity = eo;
		return this;
	};	
	this.CallBack = function(cb)
	{
		CallBack = cb;
		return this;
	};
	this.Excute = function()
	{
		Object.style.display = 'block';
		var StartOpacity = parseFloat(Object.style.opacity);
		var StartTime = new Date().getTime();
		function Run()
		{
			var NewTime = new Date().getTime();
			var d = Tween((NewTime - StartTime) / parseFloat(Time));
			
			//alert(Object.style.opacity);
			if (Time >= (NewTime - StartTime))
			{
				Object.style.opacity = StartOpacity + d * (EndOpacity - StartOpacity);				
				setTimeout(Run, 10);
			}
			else
			{
				Object.style.opacity = EndOpacity;
				CallBack(this);
			}
		}
		Run();
		return this;
	};
	return this;
}





function Resize(Object)
{	
	var OperatedObjects = ComponentSearcher(Object);
	var Tween = Lib_Tween['None'];
	var Time = 500;
	var EndScale = 1;
	var Anchor = 'lefttop';
	var Anime = true;
	var WithContent = true;
	var CallBack = function(){};	
	//Getters
		
	//Setters
	
	function ComponentSearcher(obj)
	{
		var ans = [];
		
		obj.OriginWidth = obj.style.width;
		obj.OriginHeight = obj.style.height;
		obj.OriginLeft = obj.style.left;
		obj.OriginTop = obj.style.top;
		var childs = obj.childNodes;
		ans.push(obj);
		for (var i = 0; i < childs.length; i++)
		{
			if (childs[i].nodeName == 'DIV' || childs[i].nodeName == 'IMG')
				ans = ans.concat(ComponentSearcher(childs[i]));		
		}
		return ans;		
	};
	function ResizeObjects(objs, d)
	{
		
		for (var obj in objs)
		{
			objs[obj].style.width = parseInt(objs[obj].OriginWidth) 
									* ((EndScale - 1) * d + 1) + 'px';
			//alert(obj.OriginWidth);
			objs[obj].style.height = parseInt(objs[obj].OriginHeight) 
									* ((EndScale - 1) * d + 1) + 'px';	
			if (objs[obj] != Object && objs[obj].style.position == 'absolute')
			{
				objs[obj].style.left = parseInt(objs[obj].OriginLeft) 
									* ((EndScale - 1) * d + 1) + 'px';
				objs[obj].style.top = parseInt(objs[obj].OriginTop) 
									* ((EndScale - 1) * d + 1) + 'px';	
			}

		}
	}
	
	this.Tween = function(tn)
	{
		Tween = Lib_Tween[tn];
		return this;
	};	
	this.Time = function(tm)
	{
		Time = tm;
		return this;
	};	
	this.EndScale = function(es)
	{	
		EndScale = es;
		return this;
	};
	this.Anchor = function(ach)
	{	
		Anchor = ach;
		return this;
	};
	this.Anime = function(anm)
	{	
		Anime = anm;
		return this;
	};
	this.WithContent = function(wc)
	{	
		WithContent = wc;
		return this;
	};
	this.CallBack = function(cb)
	{
		CallBack = cb;
		return this;
	}; 
	this.Excute = function()
	{
		var StartTime = new Date().getTime();
		function Run()
		{
			var NewTime = new Date().getTime();
			var d = Tween((NewTime - StartTime) / parseFloat(Time));
						
			if (Time >= (NewTime - StartTime))
			{
				ResizeObjects(OperatedObjects, d);
				setTimeout(Run, 1);
			}
			else
			{
				ResizeObjects(OperatedObjects, 1);
				CallBack(this);
			}
		}
		Run();
		
		return this;
	};
	return this;
}


function Move(Object)
{
	var OriginalPos = new AbsoluteXY(
							parseInt(Object.style.left),
							parseInt(Object.style.top)
							);
	var Tween = Lib_Tween['None'];
	var Time = 500;
	var To = OriginalPos;
	var isWrapped = false;
	var wrapper = null;
	var Route = Lib_Route['Line'];
	var CallBack = function(){};
	
	
	//Getters
	this.getTo = function()
	{
		return To;
	}
	this.getFrom = function()
	{
		return OriginalPos;
	}
	
	//Setters
	this.Tween = function(anm)
	{
		Tween = Lib_Tween[anm];
		return this;
	};	
	this.Time = function(tm)
	{
		Time = tm;
		return this;
	};
	this.To = function(to)
	{	
		To = to;
		return this;
	};
	this.Route = function(rt)
	{	
		Route = Lib_Route[rt];
		return this;
	};	
	this.Wrap = function(dr, ds, sz, sn)
	{
		wrapper = new Wrapper(dr, ds, sz, sn);
		wrapper.wrap(Object);
		isWrapped = true;
		return this;
	};
	this.CallBack = function(cb)
	{
		CallBack = cb;
		return this;
	};
	this.Excute = function()
	{		
		var StartTime = new Date().getTime();
		function Run()
		{
			var NewTime = new Date().getTime();
			var d = Tween((NewTime - StartTime) / parseFloat(Time));
			if (Time >= (NewTime - StartTime))
			{
				Route(Object, OriginalPos, To, d, wrapper);
				setTimeout(Run, 1);
			}
			else
			{
				Route(Object, OriginalPos, To, 1, wrapper);
				CallBack(this);
			}
		}
		Run();
		return this;
	};
	return this;
}




function Hover(Object)
{		
	var InFunc = function(){};
	var OutFunc = function(){};
	var UnBreaked = true;
	
	var IN = 1, OUT = 2;
	var MouseState = OUT;
	var REST = 1, RUN = 2;
	var AnimeState = REST; 
	//Getters
		
	//Setters
	this.InFunc = function(inf)
	{
		InFunc = inf;
		return this;
	};
	this.OutFunc = function(outf)
	{
		OutFunc = outf;
		return this;
	};
	this.UnBreaked = function(ub)
	{
		UnBreaked = ub;
		return this;
	}
	function InFuncDone()
	{			
		if (MouseState == OUT)
			OutFunc(OutFuncDone);
		else
			AnimeState = REST;			
	}
	function OutFuncDone()
	{
		if (MouseState == IN)
			InFunc(InFuncDone);
		else
			AnimeState = REST;				
	};	
	this.Excute = function()
	{
		Object.onmouseover = function()
		{			
			MouseState = IN;
			if (AnimeState == REST)
			{
				AnimeState = RUN;
				InFunc(InFuncDone);
			}
		}
		Object.onmouseout = function()
		{
			MouseState = OUT;
			if (AnimeState == REST)
			{
				AnimeState = RUN;
				OutFunc(OutFuncDone);
			}						
		}
		return this;
	};
	return this;
}



function Hide(Object)
{	
	var Tween = Lib_Tween['None'];
	var Time = 500;
	var EndOpacity = 0;
	var CallBack = function(){};	
	//Getters
		
	//Setters
	this.Tween = function(tn)
	{
		Tween = Lib_Tween[tn];
		return this;
	};	
	this.Time = function(tm)
	{
		Time = tm;
		return this;
	};
	this.EndOpacity = function(eo)
	{	
		EndOpacity = eo;
		return this;
	};	
	this.CallBack = function(cb)
	{
		CallBack = cb;
		return this;
	};
	this.Excute = function()
	{
		Object.style.display = 'block';
		var StartOpacity = parseFloat(Object.style.opacity);
		var StartTime = new Date().getTime();
		function Run()
		{
			var NewTime = new Date().getTime();
			var d = Tween((NewTime - StartTime) / parseFloat(Time));
			
			//alert(Object.style.opacity);
			if (Time >= (NewTime - StartTime))
			{
				Object.style.opacity = StartOpacity + d * (EndOpacity - StartOpacity);				
				setTimeout(Run, 10);
			}
			else
			{
				Object.style.opacity = EndOpacity;				
				CallBack(this);
			}
		}
		Run();
		return this;
	};
	return this;
}



function Click(Object)
{		
	var DoFunc = function(){};
	var UnBreaked = true;
	
	var REST = 1, RUN = 2;
	var AnimeState = REST; 
	//Getters
		
	//Setters
	this.DoFunc = function(dof)
	{
		DoFunc = dof;
		return this;
	};	
	this.UnBreaked = function(ub)
	{
		UnBreaked = ub;
		return this;
	}
	function DoFuncDone()
	{				
		AnimeState = REST;			
	}
	this.Excute = function()
	{
		Object.onclick = function()
		{			
			if (AnimeState == REST)
			{
				AnimeState = RUN;
				DoFunc(DoFuncDone);
			}
		}		
		return this;
	};
	return this;
}



function Create(type)
{
	var Object = document.createElement(type);
	this.Id = function (id)
	{
		Object.id = id;
		return this;
	}
	this.Class = function(cls)
	{
		Object.className = cls;
		return this;
	}
	this.Style = function(stl)
	{
		Lib_Style[stl](Object);
		return this;
	}
	this.At = function(at)
	{
		Object.style.position = "absolute";
		Object.style.left = at.x + 'px';
		Object.style.top = at.y + 'px';
		return this;
	}
	this.Size = function(dx, dy)
	{
		Object.style.width = dx + 'px';
		Object.style.height = dy + 'px';
		return this;
	}
	this.BackGround = function(cl)
	{
		Object.style.background = cl;
		return this;
	}
	this.Src = function(src)
	{	
		Object.src = src;
		return this;
	}	
	this.CornerRadius = function(r)
	{
		Object.style.borderRadius = r + 'px';
		return this;
	}
	this.AppendBy = function(obj)
	{
		obj.appendChild(Object);
		return this;
	}
	this.AppendByBody = function()
	{
		document.body.appendChild(Object);
		return this;
	}
	this.Get = function()
	{		
		return Object;
	}
	return this;
}


function test1()
{
	var Box = document.getElementById('box');
	
	var pos = new AbsoluteXY(0, 0);	
	var newObj = new Create('div').Class('c1').At(pos).Size(100, 200).Style('first').AppendBy(Box).Get();
	var target1 = new AbsoluteXY(200, 300);	
	new Move(newObj).Wrap('right').Time(150).Tween('Quad').To(new AbsoluteXY(100, 0)).Excute();	
	
	new Hover(newObj)
	.InFunc(function(done){
		var aShow = Show(newObj).Time(200).CallBack(done).Excute();
	})
	.OutFunc(function(done){
		var aHide = Hide(newObj).Time(200).CallBack(done).Excute();
	})
	.Excute();
	
	var aClick = new 
	Click(newObj)
	.DoFunc(function(done){
		var aHide = Hide(newObj).Time(200).CallBack(function(){
			var aShow =Show(newObj).Time(200).CallBack(done).Excute();
		}).Excute();
	})	
	.Excute();
	
	
	
}
</script>
<button onclick = "test1()" >Test!!</button>
<div id = 'box'; style="border: 1px solid #666666; height:400px; width:500px; left:0px; top:200px; position: absolute" >
</div>